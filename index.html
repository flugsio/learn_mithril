<!doctype html>
<title>Test mithril</title>
<script src="http://cdnjs.cloudflare.com/ajax/libs/mithril/0.1.34/mithril.min.js"></script>
<script>

// helps with debugging code that is eating errors
// use like this m("button", {onclick: thrw(todo.vm.add), id: "hej"}, "Add")
var thrw = function(callback, object) {
  return function() {
    try {
      return callback.call(object);
    } catch(e) {
      console.log(e);
    }
  };
}

var todo = {};

todo.Todo = function(data) {
  this.description = m.prop(data.description);
  this.done = m.prop(false);
};

todo.TodoList = Array;

todo.vm = {
  init: function() {
    todo.vm.list = new todo.TodoList();
    todo.vm.description = m.prop('');

    todo.vm.add = function() {
      if (todo.vm.description()) {
        todo.vm.list.push(new todo.Todo({description: todo.vm.description()}));
        todo.vm.description("");
      }
    };
  }
};

todo.controller = function() {
  todo.vm.init();
}

todo.view = function() {
  var vm = todo.vm;
  return m("html", [
      m("body", [
        m("input", {
          onchange: m.withAttr("value", vm.description),
          value: vm.description()
        }),
        m("button", {onclick: thrw(todo.vm.add), id: "hej"}, "Add"),
        m("table", [
          todo.vm.list.map(function(task, index) {
            return m("tr", [
                m("td", [
                  m("input[type=checkbox]", {
                    onclick: m.withAttr("checked", task.done),
                    checked: task.done()
                  })
                ]),
                m("td", {textDecoratoin: task.done() ? "line-through" : "none"} , task.description())
            ])
          })
        ])
      ])
  ]);
};

m.module(document, {controller: todo.controller, view: todo.view});

</script>
